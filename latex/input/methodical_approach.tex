\chapter{Implementation of the Simulation Study}
\label{sec:methodical_approach}

\section{Carrying out the Simulation}
All the methods introduced in the previous chapters were implemented in Python. To analyze their behavior, we conducted a simulation of $n = 1$ paths of the Heston model using the Quadratic Exponential (QE) scheme by Andersen (\citeyear{andersenEfficientSimulationHeston2007}). Since the results are averaged over time, simulating multiple paths was deemed unnecessary. The simulation was based on interday 5-minute price data, with 79 observations per trading day, 22 trading days per month, 12 months per year, and a total simulation period of 15 years ($T = 15$), leading to 312,840 prices per path. A burn-in period of three years was applied to eliminate biases stemming from the initial price $S_0 = 100$ and initial volatility $v_0$.

The simulation covered a broad parameter space inspired by the estimates of Eraker (\citeyear{erakerStockPricesVolatility2004}). Specifically, $v_0$ ranged from 0.01 to 0.5 in steps of 0.05, $\kappa$ from 0.01 to 1 in steps of 0.1, $\theta$ from 0.01 to 1 in steps of 0.05, and $\sigma$ from 0.01 to 1 in steps of 0.05. The drift parameter $\mu$ took only two values, 0 and 0.05, while the correlation $\rho$ varied from -0.9 to 0.9 in steps of 0.1. In total, the simulation encompassed 1,440,000 parameter combinations.

Preliminary tests revealed that the QE scheme occasionally produces numerical errors, particularly when the Feller condition is strongly violated. A closer inspection of these cases showed that the issue manifests as an excessive number of price values clustering at the same level. To systematically detect these errors, the frequency of the most common price value was recorded for the first simulated path of each scenario. In simulations without errors, this frequency remained in the single-digit range, whereas in faulty simulations, it surged into the hundreds or thousands, indicating numerical instability.

For each simulated path, we computed the first four realized moments, skewness, and kurtosis following Neuberger \& Payne (\citeyear{neubergerSkewnessStockMarket2021}), as well as the first four cumulants based on Fukasawa \& Matsushita (\citeyear{fukasawaRealizedCumulantsMartingales2021}). Since this process is computationally intensive, requiring approximately 100 seconds per simulation on a 1.8 GHz Dual-Core Intel Core i5, parallelization was employed to improve efficiency. To manage large-scale data output, each computing core stored its results in a separate CSV file, minimizing write conflicts. The collected data was then merged into a central database for further analysis.

Additionally, for each simulation, we computed the theoretical mean, variance, skewness, and kurtosis of the returns based on the closed-form expressions derived in Okhrin et al. (\citeyear{okhrinDistributionalPropertiesContinuous2023}). Since these quantities depend only on the model parameters, they could be computed efficiently using basic arithmetic operations, allowing their calculation to be performed directly within the database.

\section{Calculating Results}
For each simulation, the Gram-Charlier expansion, the Gram-Charlier expansion with positivity constraints, the Edgeworth expansion, the Edgeworth expansion with positivity constraints, the Cornish-Fisher expansion, and the Saddlepoint approximation are computed. Each expansion method is applied to both the first four realized moments and the first four cumulants.

To evaluate the accuracy of these expansions, the theoretical density is derived from the characteristic function and compared to the densities obtained from the expansions using the Kolmogorov-Smirnov test (\cite{kolmogorovSullaDeterminazioneEmpirica1993}), the Cramér-von-Mises test (\cite{vonmisesWahrscheinlichkeitStatistikUnd1928, cramerCompositionElementaryErrors1928, andersonDistributionTwoSampleCramervon1962}), and the Anderson-Darling test (\cite{andersonTestGoodnessFit1954}). While the Kolmogorov-Smirnov test measures the overall fit between two distributions, the Cramér-von-Mises test and the Anderson-Darling test place greater emphasis on the tails of the distribution. This is particularly relevant for financial markets, where heavy tails arise due to crises and market crashes. The Cramér-von-Mises test is less sensitive to the tails than the Anderson-Darling test, providing a balanced assessment of goodness-of-fit.

Since these tests require samples drawn from the cumulative distribution function (CDF), a numerical CDF is constructed from the density by performing cumulative summation and normalizing all values so that the last element equals 1.

Additionally, to further analyze the tails of the distributions, the Hill estimator is used to estimate the tail index $\alpha$ (\cite{hillSimpleGeneralApproach1975}). The tail index is a shape parameter that characterizes the power-law behavior of a distribution, where larger values of $\alpha$ indicate thinner tails (\cite{fischlerAnswerDefinitionTailindex2017, danielssonTailIndexEstimation2016}).

As previously noted in the discussion on the Heston model, the formula in Equation \eqref{eq:heston_model_characteristic_function_C} can lead to overflow errors, as Python's floating-point arithmetic is limited to values in the range $10^{-308}$ to $10^{308}$. To address this, the reformulated expression in Equation \eqref{eq:heston_model_characteristic_function_C_2} is used for computations.